<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å­¸åˆ†è¨ˆç®—å™¨</title>
  <style>
    body { font-family: sans-serif; padding: 20px; line-height: 1.8; }
    label { display: block; margin-top: 10px; }
    input { padding: 5px; width: 100%; max-width: 300px; }
    button { margin-top: 20px; padding: 10px 20px; }
    #result, #courseImpactResult { margin-top: 20px; font-weight: bold; white-space: pre-line; }
    .red { color: red; }
    .green { color: green; }
    hr { margin: 30px 0; }
  </style>
</head>
<body>
  <h2>å­¸æœŸæˆç¸¾ç›®æ¨™è¨ˆç®—å™¨</h2>

  <label>ç›®å‰ç¸½å­¸åˆ†ï¼š</label>
  <input type="number" id="currentCredits" placeholder="ä¾‹å¦‚ï¼š80">

  <label>ç›®å‰åŠ æ¬Šå¹³å‡åˆ†æ•¸ï¼š</label>
  <input type="number" id="currentAverage" placeholder="ä¾‹å¦‚ï¼š82">

  <label>é€™å­¸æœŸè¨ˆåŠƒä¿®ç¿’çš„å­¸åˆ†ï¼š</label>
  <input type="number" id="newCredits" placeholder="ä¾‹å¦‚ï¼š20">

  <label>ç›®æ¨™ç¸½å¹³å‡åˆ†æ•¸ï¼š</label>
  <input type="number" id="targetAverage" placeholder="ä¾‹å¦‚ï¼š84">

  <button onclick="calculate()">è¨ˆç®—éœ€è¦çš„é€™å­¸æœŸå¹³å‡åˆ†æ•¸</button>

  <div id="result"></div>

  <hr>

  <h3>å–®ä¸€èª²ç¨‹åˆ†æ•¸å½±éŸ¿è©•ä¼°</h3>

  <label>è©²èª²å­¸åˆ†ï¼š</label>
  <input type="number" id="courseCredits" placeholder="ä¾‹å¦‚ï¼š3">

  <label>é ä¼°è©²èª²åˆ†æ•¸ï¼š</label>
  <input type="number" id="courseGrade" placeholder="ä¾‹å¦‚ï¼š90">

  <button onclick="evaluateCourseImpact()">è©•ä¼°é€™å ‚èª²çš„å½±éŸ¿</button>

  <div id="courseImpactResult"></div>

  <script>
    let lastRequiredAvg = null;

    function calculate() {
      const currentCredits = parseFloat(document.getElementById('currentCredits').value);
      const currentAverage = parseFloat(document.getElementById('currentAverage').value);
      const newCredits = parseFloat(document.getElementById('newCredits').value);
      const targetAverage = parseFloat(document.getElementById('targetAverage').value);

      if (isNaN(currentCredits) || isNaN(currentAverage) || isNaN(newCredits) || isNaN(targetAverage)) {
        document.getElementById('result').innerText = 'è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½';
        return;
      }

      const totalCredits = currentCredits + newCredits;
      const totalRequiredScore = targetAverage * totalCredits;
      const currentScore = currentAverage * currentCredits;
      const requiredThisSemesterScore = totalRequiredScore - currentScore;
      const requiredAverageThisSemester = requiredThisSemesterScore / newCredits;

      lastRequiredAvg = requiredAverageThisSemester;

      document.getElementById('result').innerText =
        `é€™å­¸æœŸå¹³å‡éœ€è¦é”åˆ°ï¼š${requiredAverageThisSemester.toFixed(2)} åˆ†`;
    }

    function evaluateCourseImpact() {
      const courseCredits = parseFloat(document.getElementById('courseCredits').value);
      const courseGrade = parseFloat(document.getElementById('courseGrade').value);

      const currentCredits = parseFloat(document.getElementById('currentCredits').value);
      const currentAverage = parseFloat(document.getElementById('currentAverage').value);
      const newCredits = parseFloat(document.getElementById('newCredits').value);

      if (
        isNaN(courseCredits) || isNaN(courseGrade) ||
        isNaN(currentCredits) || isNaN(currentAverage) || isNaN(newCredits)
      ) {
        document.getElementById('courseImpactResult').innerText = 'è«‹ç¢ºä¿æ‰€æœ‰æ¬„ä½éƒ½æ­£ç¢ºå¡«å¯«';
        return;
      }

      if (!lastRequiredAvg) {
        document.getElementById('courseImpactResult').innerText = 'è«‹å…ˆè¨ˆç®—é€™å­¸æœŸç›®æ¨™å¹³å‡åˆ†æ•¸';
        return;
      }

      const remainingCredits = newCredits - courseCredits;
      if (remainingCredits <= 0) {
        document.getElementById('courseImpactResult').innerText = 'èª²ç¨‹å­¸åˆ†ä¸èƒ½å¤§æ–¼æˆ–ç­‰æ–¼é€™å­¸æœŸç¸½å­¸åˆ†';
        return;
      }

      // 1ï¸âƒ£ å°é€™å­¸æœŸå¹³å‡çš„è²¢ç»
      const totalRequiredThisSemesterScore = newCredits * lastRequiredAvg;
      const knownCourseScore = courseCredits * courseGrade;
      const requiredAvgForOtherCourses = (totalRequiredThisSemesterScore - knownCourseScore) / remainingCredits;

      // 2ï¸âƒ£ å°ç¸½å¹³å‡çš„å½±éŸ¿
      const totalScoreBefore = currentAverage * currentCredits;
      const totalScoreAfter = totalScoreBefore + courseCredits * courseGrade;
      const newTotalCredits = currentCredits + courseCredits;
      const newOverallAverage = totalScoreAfter / newTotalCredits;
      const overallAvgDiff = newOverallAverage - currentAverage;

      const impactColor = overallAvgDiff >= 0 ? 'red' : 'green';
      const impactText = overallAvgDiff >= 0 ? 'ä¸Šå‡' : 'ä¸‹é™';

      document.getElementById('courseImpactResult').innerHTML =
        `ğŸ¯ è‹¥é€™å ‚èª²å¾— ${courseGrade} åˆ†ï¼Œå  ${courseCredits} å­¸åˆ†ï¼š<br>` +
        `â¤ è¦é”æˆé€™å­¸æœŸå¹³å‡ ${lastRequiredAvg.toFixed(2)} åˆ†ï¼Œå…¶ä»– ${remainingCredits} å­¸åˆ†éœ€å¹³å‡ï¼š${requiredAvgForOtherCourses.toFixed(2)} åˆ†<br>` +
        `â¤ å°ç¸½å¹³å‡çš„å½±éŸ¿ï¼š<span class="${impactColor}">${impactText} ${Math.abs(overallAvgDiff).toFixed(2)} åˆ†</span>ï¼ˆæ–°ç¸½å¹³å‡ï¼šç´„ ${newOverallAverage.toFixed(2)}ï¼‰`;
    }
  </script>
</body>
</html>
